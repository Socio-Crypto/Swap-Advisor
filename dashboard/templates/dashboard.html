{% extends "base-dashboard.html" %}
{% load i18n %}
{% block secondary_menu %}
{% endblock secondary_menu %}
{% load static %}

{% block title %}
<!-- {% trans 'Accounts' %} -->
{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item">
  <a href=""><i class="icon-home"></i>
  </a>
</li>
<li class="breadcrumb-item active">{% trans 'Dashboard' %}</li>
{% endblock %}


{% block content %}

<section class="container assess-list">
  <div class="container-fluid project-list">
    <div class="row clearfix">
      <div class="col-xl-12 col-lg-12 col-md-12">
        <div class="card"></div>
      </div>
    </div>
    <div class="row clearfix">
      <div class="col-xl-12 col-lg-12 col-md-12">
          <div class="card">
              <div class="body">
                <h4><strong>Which DEX offers the best price?</strong></h4>
              </div>
          </div>
      </div>
  </div>
    <div class="row clearfix">
      <div class="col-xl-12 col-lg-12 col-md-12">
          <div class="card">
              <div class="body">
                <h4><strong>Median and Average of Exchange Rates per DEX</strong></h4>
                <p>This section provides information on the available options for directly swapping the selected token pairs. It
                  visualizes the average and median exchange rates across various decentralized exchanges (DEXes) during the specified
                  past time period for the chosen tokens.</p>
                <p>
                  The table below also includes additional metrics such as the number of swaps executed on each DEX for the given pair
                  and the number of unique wallets that have used these DEXes for the specified swap.
                </p>
                <p>This section offers further insights into the performance and popularity of DEXes for the selected token swap.</p>
              </div>
          </div>
      </div>
  </div>
    <div class="row clearfix">
      <div class="col-xl-6 col-lg-6 col-md-12">
        <div class="card">
          <div class="body">
            <h4><strong>Median Rate per Platform</strong></h4>
            <input type="hidden" id="median" value="{{ median }}">
            <div id='medium_rate_per_platform' style="height: 400px;"></div>
            <p class="d-flex justify-content-center"
              style="align-content: center; font-variant-caps: all-petite-caps;">
            </p>
          </div>
        </div>
      </div>
 
      <div class="col-xl-6 col-lg-6 col-md-12">
        <div class="card">
          <div class="body">
            <h4><strong>Average of Exchange Rate</strong></h4>
            <input type="hidden" id="average" value="{{ average }}">
            <div id='average_of_exchange_rate' style="height: 400px;"></div>
            <p class="d-flex justify-content-center"
              style="align-content: center; font-variant-caps: all-petite-caps;">
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="row clearfix">
      <div class="col-md-12 col-lg-12 col-xl-12">
        <div class="card">
          <div id="chart2-container"></div>
          <div class="body table-responsive">
            <table class="table m-b-0 table-striped table-dark table-borderless table-black" id="network_table">
              <thead>
                <tr>
                  <th scope="col">PLATFORM</th>
                  <th scope="col">Average of Exch. Rate</th>
                  <th scope="col">Median of Exch. Rate</th>
                  <th scope="col">Number of Swaps</th>
                  <th scope="col">Number of Swappers</th>
                </tr>
              </thead>
              <tbody>
                {% for item in data %}
                <tr>
                  <td>{{ item.platform }}</td>
                  <td>{{ item.average_of_exch_rate|floatformat:7 }}</td>
                  <td>{{ item.median_of_exch_rate|floatformat:7 }}</td>
                  <td>{{ item.number_of_swaps|floatformat:0 }}</td>
                  <td>{{ item.number_of_swappers|floatformat:0 }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>

    </div>


    <div class="row clearfix">
      <div class="col-xl-12 col-lg-12 col-md-12">
          <div class="card">
              <div class="body">
                <h4><strong>Which DEX is the most commonly used on average?</strong></h4>
              </div>
          </div>
      </div>
  </div>

  <div class="row clearfix">
    <div class="col-xl-12 col-lg-12 col-md-12">
        <div class="card">
            <div class="body">
              <h4><strong>DEX Popularity</strong></h4>
              <p>This section provides insights into the popularity and usage of different decentralized exchanges (DEXes) based on average usage. It showcases the DEX that is most frequently utilized for the selected token swap pair.</p>
              <p>
                By analyzing data on the number of swaps executed and the number of unique wallets using each DEX for the given swap, this section highlights the DEX that exhibits the highest average usage among users.
              </p>
              <p>Understanding the most commonly used DEX can help you make informed decisions about where to execute your token swaps for optimal convenience and liquidity.</p>
            </div>
        </div>
    </div>
</div>

<div class="row clearfix">
  <div class="col-xl-6 col-lg-6 col-md-12">
    <div class="card">
      <div class="body">
        <h4><strong>Number of Traders per Platform</strong></h4>
        <input type="hidden" id="swaps" value="{{ swaps }}">
        <div id='number_of_traders_per_platform' style="height: 400px;"></div>
        <p class="d-flex justify-content-center"
          style="align-content: center; font-variant-caps: all-petite-caps;">
        </p>
      </div>
    </div>
  </div>

  <div class="col-xl-6 col-lg-6 col-md-12">
    <div class="card">
      <div class="body">
        <h4><strong>Number of Trades per Platform</strong></h4>
        <input type="hidden" id="swappers" value="{{ swappers }}">
        <div id='number_of_trades_per_platform' style="height: 400px;"></div>
        <p class="d-flex justify-content-center"
          style="align-content: center; font-variant-caps: all-petite-caps;">
        </p>
      </div>
    </div>
  </div>
</div>

<div class="row clearfix">
  <div class="col-xl-12 col-lg-12 col-md-12">
      <div class="card">
          <div class="body">
            <h4><strong>Which DEX offers the best combination of popularity and price?</strong></h4>
          </div>
      </div>
  </div>
</div>

<div class="row clearfix">
  <div class="col-xl-12 col-lg-12 col-md-12">
      <div class="card">
          <div class="body">
            <p>This section evaluates the combination of popularity and price across different decentralized exchanges (DEXes) for
              the selected token swap pair. It considers both the average usage and the exchange rates offered by each DEX.</p>
            <p>
              By considering metrics such as the number of swaps executed, the number of unique wallets using each DEX for the
              given swap, and the average exchange rates provided, this section identifies the DEX that offers the optimal balance
              between popularity and favorable pricing.
            </p>
            <p>
              This analysis helps you determine the DEX that not only enjoys significant user activity but also provides
              competitive prices for your token swaps. Making use of such a DEX can maximize the chances of obtaining desirable
              rates while benefiting from a thriving trading environment.
            </p>
          </div>
      </div>
  </div>
</div>


<div class="row clearfix">
  <div class="col-xl-6 col-lg-6 col-md-12">
    <div class="card">
      <div class="body">
        <h4><strong>Median Rate and Number of Traders</strong></h4>
        <div id='median_rate_and_number_of_traders' style="height: 300px;"></div>
        <p class="d-flex justify-content-center"
          style="align-content: center; font-variant-caps: all-petite-caps;">
        </p>
      </div>
    </div>
  </div>

  <div class="col-xl-6 col-lg-6 col-md-12">
    <div class="card">
      <div class="body">
        <h4><strong>Average Rate and Number of Traders</strong></h4>
        <div id='average_rate_and_number_of_traders' style="height: 300px;"></div>
        <p class="d-flex justify-content-center"
          style="align-content: center; font-variant-caps: all-petite-caps;">
        </p>
      </div>
    </div>
  </div>
</div>


<div class="row clearfix">
  <div class="col-xl-12 col-lg-12 col-md-12">
      <div class="card">
          <div class="body">
            <h4><strong>What is the optimal hour and day for the swap?</strong></h4>
          </div>
      </div>
  </div>
</div>
<div class="row clearfix">
  <div class="col-xl-12 col-lg-12 col-md-12">
    <div class="card">
      <div class="body">
        <p>
          This section analyzes historical data to identify the optimal hour and day for executing the swap. By
          examining patterns and trends, it determines when the market conditions have historically been most favorable
          for the selected token swap.
        </p>
        <p>
          This analysis takes into account factors such as historical exchange rate and popularity during different
          hours of the day and days of the week. By leveraging this information, you can strategically time your swaps
          to potentially maximize returns or minimize slippage.
        </p>
      </div>
    </div>
  </div>
</div>

<div class="row clearfix">
  <div class="col-xl-6 col-lg-6 col-md-12">
    <div class="card">
      <div class="body">
        <h4><strong>Average Rate per Day Hour and Week Days</strong></h4>
        <input type="hidden" id="data_time" value="{{ data_time }}">
        <div id='average_rate_per_day_hour_and_week_days' style="height: 300px;"></div>
        <p class="d-flex justify-content-center"
          style="align-content: center; font-variant-caps: all-petite-caps;">
        </p>
      </div>
    </div>
  </div>

  <div class="col-xl-6 col-lg-6 col-md-12">
    <div class="card">
      <div class="body">
        <h4><strong style="font-size: 21px;">Avg. Number of Swaps per Day Hour and Week Days</strong></h4>
        <div id='avg_number_of_swaps_per_day_hour_and_week_days' style="height: 300px;"></div>
        <p class="d-flex justify-content-center"
          style="align-content: center; font-variant-caps: all-petite-caps;">
        </p>
      </div>
    </div>
  </div>
</div>

  </div>
</section>

{% endblock %}

{% block scripts %}
<script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>


<script>
  async function bar_chart_api_1(dataText, id, decimals) {
    
 
    var dataObject = JSON.parse(dataText);

    var success_list = Object.values(dataObject);
    var success_labels = Object.keys(dataObject);
    var options = {
      series: [
        {
          data: success_list,
        },
      ],
      chart: {
        height: 500,
        type: "bar",
        toolbar: {
          show: true,
          autoSelected: "zoom",
          tools: {
            download: true,
            customIcons: [
              {
                icon: '<a href="https://app.flipsidecrypto.com/velocity/queries/" target="blank"><span class="iconify" data-icon="fa:database"></span></a>',
                index: 5,
                title: "Query",
                class: "custom-icon",
              },
            ],
          },
        },
      },
      plotOptions: {
        bar: {
          borderRadius: 10,
          dataLabels: {
            position: "top", // top, center, bottom
          },
          distributed: true,
        },
      },
      colors: [
        '#04e1cb', '#1b96ff', '#ba01ff', '#baec70', '#ff5d2d', '#ac8e68', '#ffe620', '#e3066a', '#04e1cb'
      ],
      dataLabels: {
        enabled: true,
        formatter: function (val) {
          return val;
        },
        offsetY: -20,
        style: {
          fontSize: "0px",
          colors: ["#195f90"],
        },
      },

      xaxis: {
        categories: success_labels,
        position: "bottom",
        axisBorder: {
          show: false,
        },
        axisTicks: {
          show: false,
        },
        labels:{
          style:{
            colors:'white'
          }
        },
        crosshairs: {
          fill: {
            type: "gradient",
            gradient: {
              colorFrom: "#D8E3F0",
              colorTo: "#BED1E6",
              stops: [0, 1],
              opacityFrom: 0.4,
              opacityTo: 0.5,
            },
          },
        },

     
      },
      yaxis: {
       
        // axisBorder: {
        //   show: false,
        // },
        // axisTicks: {
        //   show: false,
        // },
        forceNiceScale: true,
      //   min: 0,
      // max: 0.08,
        labels: {
          show: true,
          formatter: function (val) {
            return val.toFixed(decimals); ;
          },
          style:{
            colors:['white']
          }
        },
      },
      legend:{
        show:false,
        labels:{
          
          colors:'white'
          
        }
      },
      title: {
        text: "",
        floating: true,
        offsetY: 100,
        align: "center",
        style: {
          color: "white",
        },
      },
      tooltip: {
            shared: false,
            theme: false,
            
            y: {
              formatter: function (val) {
                return (val).toFixed(0)
              }
            }
          }
      
    };

    var chart = new ApexCharts(document.querySelector(id), options);
    chart.render();
  }
</script>

<script>
  var dataText = document.getElementById("median").value.replaceAll("'", '"');
  var id = '#medium_rate_per_platform'
  bar_chart_api_1(dataText, id, 10)
 
  var dataText = document.getElementById("average").value.replaceAll("'", '"');
  var id = '#average_of_exchange_rate'
  bar_chart_api_1(dataText, id, 10)
 
 
  var dataText = document.getElementById("swappers").value.replaceAll("'", '"');
  var id = '#number_of_traders_per_platform'
  bar_chart_api_1(dataText, id, 0)
 
  var dataText = document.getElementById("swaps").value.replaceAll("'", '"');
  var id = '#number_of_trades_per_platform'
  bar_chart_api_1(dataText, id, 0)
  
  // var dataText = document.getElementById("median_rate_and_traders").value.replaceAll("'", '"');
  // var id = '#median_rate_and_number_of_traders'
  // bar_chart_api_1(dataText, id, 0)

  // var dataText = document.getElementById("swaps").value.replaceAll("'", '"');
  // var id = '#number_of_trades_per_platform'
  // bar_chart_api_1(dataText, id, 0)
</script>


<script>

  async function base_scatter_plot(dataText_x, dataText_y, decimals, html_id) {


    console.log('dataText', dataText_x)
    console.log('dataText', dataText_y)
    var dataObject_x = JSON.parse(dataText_x);
    var dataObject_y = JSON.parse(dataText_y);

    var x = Object.values(dataObject_x);
    var y = Object.values(dataObject_y);

    const target_data = []
    const target_data_test = []
    for (let i = 0; i < x.length; i++) {
      target_data.push({ name: '', data: [[x[i], y[i]]] })
      // target_data_test.push({  x: x[i], y:y[i] })
    }

    var options = {
      series: target_data,
      chart: {
        height: 300,
        type: "scatter",
        zoom: {
          type: "xy",
        },
      },
      dataLabels: {
        enabled: false,
      },
      grid: {
        xaxis: {
          lines: {
            show: true,
          },
        },
        yaxis: {
          lines: {
            show: true,
          },
        },
      },
      xaxis: {
        type: "numeric",
        tickAmount: 10,

        title: {
          text: "Median of Exch. Rate",
          style: {
            color: ['white']
          },
        },
        labels: {
          style: {
            colors: ['white']
          },
          show: true,
          formatter: (value) => {
            return (value).toFixed(4);
          },

        },

      },

      markers: {
        size: 9,
        colors: [
          '#04e1cb', '#1b96ff', '#ba01ff', '#baec70', '#ff5d2d', '#ac8e68', '#ffe620', '#e3066a', '#04e1cb'
        ],
      },
      legend: {
        show: false,

      },
      yaxis: {
        labels: {
          show: true,
          style: {
            colors: ['white']
          },
          formatter: (value) => {
            return value.toFixed(0);
          },

        },
        title: {
          text: "Number of Swappers",
          style: {
            color: ['white']
          },
        },

      },
      tooltip: {
        shared: false,
        theme: false,
        y: {
          formatter: function (val) {
            return (val).toFixed(2)
          }
        }
      },
      grid: {
        show: true,
      }
    };

    var chart = new ApexCharts(
      document.querySelector(html_id),
      options
    );
    chart.render();
  }
</script>

<script>
  var dataText_x = document.getElementById("median").value.replaceAll("'", '"');
  var dataText_y = document.getElementById("swappers").value.replaceAll("'", '"');
  var html_id = "#median_rate_and_number_of_traders"
  var decimals = 0
  base_scatter_plot(dataText_x, dataText_y, decimals, html_id);
 
  var dataText_x = document.getElementById("average").value.replaceAll("'", '"');
  var dataText_y = document.getElementById("swappers").value.replaceAll("'", '"');
  var html_id = "#average_rate_and_number_of_traders"
  var decimals = 0
  base_scatter_plot(dataText_x, dataText_y, decimals, html_id);

</script>

<script>
  async function average_rate_api(){
      var average_rate_list = {'Mon':[],'Tue':[],'Wed':[],'Thu':[],'Fri':[],'Sat':[],'Sun':[]};
      var dataText_x = document.getElementById("data_time").value.replaceAll("'", '"');
      var dataObject = JSON.parse(dataText_x);
      for (let index = 0; index < dataObject.length; index++) {
      const average_rate_element = dataObject[index];
      average_rate_list[average_rate_element['day']].push(average_rate_element['avg']);  
      }

      console.log('average_rate_list', average_rate_list);
      var options = {
        series: [{
        name: 'Monday',
        data: average_rate_list['Mon']
      },
      {
        name: 'Tuesday',
        data: average_rate_list['Tue']
      },
      {
        name: 'Wednesday',
        data: average_rate_list['Wed']
      },
      {
        name: 'Thursday',
        data: average_rate_list['Thu']
      },
      {
        name: 'Friday',
        data: average_rate_list['Fri']
      },
      {
        name: 'Satturday',
        data: average_rate_list['Sat']
      },
      {
        name: 'Sunday',
        data: average_rate_list['Sun']
      }
      ],
        chart: {
        height: 450,
        type: 'heatmap',
        // toolbar: {
        //   show:true,
        //   autoSelected: 'zoom',
        //   tools:{
        //     download: true,
        //     customIcons: [{
        //         icon: '<a href="https://app.flipsidecrypto.com/velocity/queries/69012a68-c68b-456b-81ce-d84f01712ff6"><span class="iconify" data-icon="fa:database"></span></a>',
        //         index: 5,
        //         title: 'Query',
        //         class: 'custom-icon'
        //         }]
        //   } 
        // }
        
      },
      yaxis:{

        labels:{
          style:{
            colors:['white']
          }
        }
      },
      dataLabels: {
        enabled: false
      },
      colors: ["#575151"],
      title: {
        text: ''
      },
      xaxis: {
        type: 'category',
        labels:{
          style:{
            colors:'white'
          }
        },
        title:{
            text:''
        },
        categories: ['00', '01', '02', '03', '04', '05', '06', '07','08', '09', '10', '11', '12', '13', '14', '15','16', '17', '18', '19', '20', '21', '22', '23'],
      },
      tooltip: {
            shared: false,
            theme: false,
            
            y: {
              formatter: function (val) {
                return (val).toFixed(4)
              }
            }
          }
      };

      var chart = new ApexCharts(document.querySelector("#average_rate_per_day_hour_and_week_days"), options);
      chart.render();
  }   
  average_rate_api();
</script>

<script>
  async function average_rate_api(){
      var average_rate_list = {'Mon':[],'Tue':[],'Wed':[],'Thu':[],'Fri':[],'Sat':[],'Sun':[]};
      var dataText_x = document.getElementById("data_time").value.replaceAll("'", '"');
      var dataObject = JSON.parse(dataText_x);
      for (let index = 0; index < dataObject.length; index++) {
      const average_rate_element = dataObject[index];
      average_rate_list[average_rate_element['day']].push(average_rate_element['n_txn']);  
      }

      console.log('average_rate_list', average_rate_list);
      var options = {
        series: [{
        name: 'Monday',
        data: average_rate_list['Mon']
      },
      {
        name: 'Tuesday',
        data: average_rate_list['Tue']
      },
      {
        name: 'Wednesday',
        data: average_rate_list['Wed']
      },
      {
        name: 'Thursday',
        data: average_rate_list['Thu']
      },
      {
        name: 'Friday',
        data: average_rate_list['Fri']
      },
      {
        name: 'Satturday',
        data: average_rate_list['Sat']
      },
      {
        name: 'Sunday',
        data: average_rate_list['Sun']
      }
      ],
        chart: {
        height: 450,
        type: 'heatmap',
        // toolbar: {
        //   show:true,
        //   autoSelected: 'zoom',
        //   tools:{
        //     download: true,
        //     customIcons: [{
        //         icon: '<a href="https://app.flipsidecrypto.com/velocity/queries/69012a68-c68b-456b-81ce-d84f01712ff6"><span class="iconify" data-icon="fa:database"></span></a>',
        //         index: 5,
        //         title: 'Query',
        //         class: 'custom-icon'
        //         }]
        //   } 
        // }
        
      },
      yaxis:{

        labels:{
          style:{
            colors:['white']
          }
        }
      },
      dataLabels: {
        enabled: false
      },
      colors: ["#575151"],
      title: {
        text: ''
      },
      xaxis: {
        type: 'category',
        labels:{
          style:{
            colors:'white'
          }
        },
        title:{
            text:''
        },
        categories: ['00', '01', '02', '03', '04', '05', '06', '07','08', '09', '10', '11', '12', '13', '14', '15','16', '17', '18', '19', '20', '21', '22', '23'],
      },
      tooltip: {
            shared: false,
            theme: false,
            
            y: {
              formatter: function (val) {
                return (val).toFixed(4)
              }
            }
          }
      };

      var chart = new ApexCharts(document.querySelector("#avg_number_of_swaps_per_day_hour_and_week_days"), options);
      chart.render();
  }   
  average_rate_api();
</script>
{% endblock %}